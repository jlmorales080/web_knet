@using Umbraco.Cms.Web.Common.PublishedModels;
@using Umbraco.Cms.Core.Models.Blocks;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<IPublishedContent>

@{
    var logo = Model.Value<IPublishedContent>("siteLogo");
    var logoUrl = logo?.Url() ?? "";
    
    // Fallbacks matching React logic
    var phone = Model.Value<string>("phoneNumber");
    if (string.IsNullOrWhiteSpace(phone)) phone = "602 260 000 / 941 54 40 80";
    
    var phoneText = Model.Value<string>("phoneText");
    if (string.IsNullOrWhiteSpace(phoneText)) phoneText = "Ll√°manos: 602 260 000 / 941 54 40 80";

    // Navigation Menu
    var navItemsList = Model.Value<IEnumerable<BlockListItem>>("navigationMenu");

    // Debugging
    if (Model == null) { <div style="color:red">HEADER MODEL IS NULL</div> }
    else { 
        <!-- Title: @Model.Name -->
        <!-- Nav Items Count: @(navItemsList?.Count() ?? 0) -->
    }
}

<div class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module">
    <section class="top-header">
        <div class="wrapper">
            <a href="/">
                @if (!string.IsNullOrEmpty(logoUrl))
                {
                    <img src="@logoUrl" alt="Knet Logo" width="131" height="95" style="max-width: 100%; height: auto;" />
                }
            </a>

            <div class="links-menus">
                <div class="inner-bnts">
                    <!-- Dynamic CTAs and Phone from Global Settings -->
                    @{
                        var headerLinks = Model.Value<BlockListModel>("headerLinks");
                    }
                    @if (headerLinks != null)
                    {
                        foreach (var item in headerLinks)
                        {
                            var link = item.Content.Value<Umbraco.Cms.Core.Models.Link>("link");
                            
                            if (link != null)
                            {
                                // If it's a NavigationLink, it's the orange phone text
                                if (item.Content.ContentType.Alias.Equals("navigationLink", StringComparison.OrdinalIgnoreCase))
                                {
                                    <a class="link-tlf aa" href="@link.Url">@link.Name</a>
                                }
                                // If it's a NavigationButtonLink, it's a styled button
                                else if (item.Content.ContentType.Alias.Equals("navigationButtonLink", StringComparison.OrdinalIgnoreCase))
                                {
                                    var styleAlias = item.Content.Value<string>("style");
                                    var cssClass = styleAlias?.ToLower() switch {
                                        "orange" => "btn-orange",
                                        "white" => "btn-ghost-blue",
                                        "blue-white" => "btn-ghost-blue",
                                        _ => "btn-ghost-blue" 
                                    };
                                    <a href="@link.Url" target="@link.Target" class="@cssClass">@link.Name</a>
                                }
                                else
                                {
                                    <a href="@link.Url" target="@link.Target">@link.Name</a>
                                }
                            }
                        }
                    }
                </div>

                <!-- Mobile Menu Trigger -->
                <div class="menu-trigger">
                    <a class="" onclick="this.classList.toggle('open'); document.querySelector('.open-menu').style.display = this.classList.contains('open') ? 'block' : 'none'; document.querySelector('.open-menu').classList.toggle('active-branch');" style="cursor: pointer">
                        <div></div>
                        <div></div>
                        <div></div>
                    </a>
                </div>

                <nav>
                    <span class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_menu">
                        <div class="hs-menu-wrapper active-branch flyouts hs-menu-flow-horizontal" role="navigation">
                            <ul role="menu">
                                @if (navItemsList != null)
                                {
                                    foreach (var item in navItemsList)
                                    {
                                        var link = item.Content.Value<Umbraco.Cms.Core.Models.Link>("link");

                                        if (link == null)
                                        {
                                            var links = item.Content.Value<IEnumerable<Umbraco.Cms.Core.Models.Link>>("link");
                                            link = links?.FirstOrDefault();
                                        }

                                        if (link != null)
                                        {
                                            // Navigation menu links MUST be black
                                            <li class="hs-menu-item hs-menu-depth-1">
                                                <a href="@link.Url" target="@link.Target" style="color: #000;">@link.Name</a>
                                            </li>
                                        }
                                    }
                                }
                            </ul>
                        </div>
                    </span>
                </nav>
            </div>
        </div>
    </section>
</div>
